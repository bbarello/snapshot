{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport React, { useState, useEffect } from 'react';\nimport { toaster } from 'baseui/toast';\nimport { Block } from 'baseui/block';\nimport { Button } from 'baseui/button';\nimport Loader from '../../components/UiElements/Loader/Loader';\nimport Toaster from '../../components/UiElements/Toaster/Toaster';\nimport AddEditModal from './AddEdit';\nimport { getDocuments, addDocument, updateDocument, deleteDocument, addCollectionAndDocuments } from '../../firebase/service';\nimport demoData from './demo.data';\nimport { getTimeStamp } from '../../firebase/initialize';\nimport CrudTable from './CrudTable';\nvar statusOptions = [{\n  label: 'Draft',\n  id: 'draft'\n}, {\n  label: 'Publish',\n  id: 'publish'\n}];\nvar TITLE = 'Firebase CRUD';\nvar SUB_TITLE = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod';\n\nvar FirebaseCRUD = function FirebaseCRUD() {\n  var toastKey;\n\n  var _useState = useState([]),\n      articles = _useState[0],\n      setArticles = _useState[1];\n\n  var _useState2 = useState(false),\n      visible = _useState2[0],\n      setVisible = _useState2[1];\n\n  var _useState3 = useState(false),\n      loading = _useState3[0],\n      setLoading = _useState3[1];\n\n  var _useState4 = useState(false),\n      editState = _useState4[0],\n      setEditState = _useState4[1];\n\n  var _useState5 = useState(false),\n      error = _useState5[0],\n      setError = _useState5[1];\n\n  var _useState6 = useState({\n    id: null,\n    title: '',\n    description: '',\n    slug: '',\n    status: []\n  }),\n      article = _useState6[0],\n      setArticle = _useState6[1];\n\n  useEffect(function () {\n    fetchData();\n  }, []);\n\n  var fetchData = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var data;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              setLoading(true);\n              _context.next = 4;\n              return getDocuments('articles');\n\n            case 4:\n              data = _context.sent;\n\n              //for demo only\n              if (!data.length) {\n                addCollectionAndDocuments('articles', demoData.map(function (data) {\n                  return _objectSpread(_objectSpread({}, data), {}, {\n                    createdAt: getTimeStamp()\n                  });\n                }));\n              }\n\n              setArticles(data);\n              setLoading(false);\n              _context.next = 14;\n              break;\n\n            case 10:\n              _context.prev = 10;\n              _context.t0 = _context[\"catch\"](0);\n              toastKey = toaster.negative(__jsx(React.Fragment, null, 'Data Fetching Failed!'), {\n                autoHideDuration: 1000\n              });\n              setLoading(false);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 10]]);\n    }));\n\n    return function fetchData() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var handleAddArticle = function handleAddArticle() {\n    setVisible(true);\n    setEditState(false);\n    setArticle({\n      id: null,\n      title: '',\n      description: '',\n      slug: '',\n      status: []\n    });\n  };\n\n  var handleModdalClose = function handleModdalClose() {\n    setVisible(false);\n    setArticle({\n      id: null,\n      title: '',\n      description: '',\n      slug: '',\n      status: []\n    });\n  };\n\n  var handleDeleteArticle = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(id) {\n      var deleted;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              if (!id) {\n                _context2.next = 13;\n                break;\n              }\n\n              _context2.prev = 1;\n              _context2.next = 4;\n              return deleteDocument('articles', id);\n\n            case 4:\n              deleted = _context2.sent;\n              toastKey = toaster.info(__jsx(React.Fragment, null, 'Deleted Successfully!'), {\n                autoHideDuration: 2000\n              });\n\n              if (deleted) {\n                fetchData();\n              }\n\n              _context2.next = 13;\n              break;\n\n            case 9:\n              _context2.prev = 9;\n              _context2.t0 = _context2[\"catch\"](1);\n              console.log(_context2.t0);\n              toastKey = toaster.info(__jsx(React.Fragment, null, 'Deletion Failed!'), {\n                autoHideDuration: 2000\n              });\n\n            case 13:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[1, 9]]);\n    }));\n\n    return function handleDeleteArticle(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleUpdateArticle = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(item) {\n      var index, status;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              setVisible(true);\n              setEditState(true);\n              index = statusOptions.findIndex(function (option) {\n                return option.id === item.status;\n              });\n              status = {\n                label: 'Draft',\n                id: 'draft'\n              };\n\n              if (index > -1) {\n                status = statusOptions[index];\n              }\n\n              setArticle(_objectSpread(_objectSpread(_objectSpread({}, article), item), {}, {\n                status: status\n              }));\n\n            case 6:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3);\n    }));\n\n    return function handleUpdateArticle(_x2) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var handleOnChange = function handleOnChange(name) {\n    return function (e) {\n      var value;\n\n      if (name === 'status') {\n        value = e.value;\n      } else {\n        value = e.target.value;\n      }\n\n      setArticle(_objectSpread(_objectSpread({}, article), {}, _defineProperty({}, name, value)));\n    };\n  };\n\n  var checkError = function checkError() {\n    var errorStatus = false;\n    var title = article.title,\n        description = article.description,\n        slug = article.slug,\n        status = article.status;\n\n    if (!title || !description || !slug || !status) {\n      errorStatus = true;\n    } else {\n      errorStatus = false;\n    }\n\n    setError(errorStatus);\n    return errorStatus;\n  };\n\n  var handleOnSubmit = /*#__PURE__*/function () {\n    var _ref4 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee4() {\n      var errorStatus, status, slug, data, id;\n      return _regeneratorRuntime.wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              errorStatus = checkError();\n              status = article.status && article.status.length ? article.status[0].id : 'draft';\n              slug = article.id ? article.slug : \"\".concat(article.slug, \"-\").concat(Date.now());\n              data = _objectSpread(_objectSpread({}, article), {}, {\n                slug: slug,\n                status: status\n              });\n              id = null;\n\n              if (!(article.id && !errorStatus)) {\n                _context4.next = 20;\n                break;\n              }\n\n              _context4.prev = 6;\n              _context4.next = 9;\n              return updateDocument('articles', data);\n\n            case 9:\n              id = _context4.sent;\n              toastKey = toaster.info(__jsx(React.Fragment, null, 'Update Successful!'), {\n                autoHideDuration: 2000\n              });\n              _context4.next = 17;\n              break;\n\n            case 13:\n              _context4.prev = 13;\n              _context4.t0 = _context4[\"catch\"](6);\n              toastKey = toaster.negative(__jsx(React.Fragment, null, 'Update Failed!'), {\n                autoHideDuration: 2000\n              });\n              console.log(_context4.t0);\n\n            case 17:\n              setVisible(false);\n              _context4.next = 33;\n              break;\n\n            case 20:\n              if (!(!article.id && !errorStatus)) {\n                _context4.next = 33;\n                break;\n              }\n\n              _context4.prev = 21;\n              _context4.next = 24;\n              return addDocument('articles', data);\n\n            case 24:\n              id = _context4.sent;\n              toastKey = toaster.info(__jsx(React.Fragment, null, 'Successful!'), {\n                autoHideDuration: 2000\n              });\n              _context4.next = 32;\n              break;\n\n            case 28:\n              _context4.prev = 28;\n              _context4.t1 = _context4[\"catch\"](21);\n              toastKey = toaster.negative(__jsx(React.Fragment, null, 'Failed!'), {\n                autoHideDuration: 2000\n              });\n              console.log(_context4.t1);\n\n            case 32:\n              setVisible(false);\n\n            case 33:\n              if (id) {\n                fetchData();\n              }\n\n            case 34:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[6, 13], [21, 28]]);\n    }));\n\n    return function handleOnSubmit() {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  return __jsx(React.Fragment, null, __jsx(Toaster, {\n    toastKey: toastKey\n  }), __jsx(Block, {\n    paddingTop: ['10px', '10px', 0],\n    overrides: {\n      Block: {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          marginBottom: '40px'\n        }\n      }\n    }\n  }, __jsx(Block, null, __jsx(Block, {\n    as: \"h3\",\n    overrides: {\n      Block: {\n        style: function style(_ref5) {\n          var $theme = _ref5.$theme;\n          return _objectSpread(_objectSpread({}, $theme.typography.font450), {}, {\n            color: $theme.colors.primaryA,\n            marginBottom: '10px'\n          });\n        }\n      }\n    }\n  }, TITLE), __jsx(Block, {\n    as: \"p\",\n    overrides: {\n      Block: {\n        style: function style(_ref6) {\n          var $theme = _ref6.$theme;\n          return _objectSpread(_objectSpread({}, $theme.typography.font200), {}, {\n            color: $theme.colors.contentSecondary\n          });\n        }\n      }\n    }\n  }, SUB_TITLE)), __jsx(Block, {\n    overrides: {\n      Block: {\n        style: {\n          flexShrink: 0\n        }\n      }\n    }\n  }, __jsx(Button, {\n    onClick: handleAddArticle,\n    overrides: {\n      BaseButton: {\n        style: function style(_ref7) {\n          var $theme = _ref7.$theme;\n          return _objectSpread({}, $theme.typography.font250);\n        }\n      }\n    }\n  }, \"Add Article\"))), __jsx(Block, {\n    overrides: {\n      Block: {\n        style: {\n          minHeight: '150px'\n        }\n      }\n    }\n  }, loading ? __jsx(Loader, null) : __jsx(CrudTable, {\n    data: articles,\n    onUpdate: handleUpdateArticle,\n    onDelete: handleDeleteArticle\n  })), __jsx(AddEditModal, {\n    error: error,\n    article: article,\n    visible: visible,\n    editState: editState,\n    statusOptions: statusOptions,\n    handleOnChange: handleOnChange,\n    handleOnSubmit: handleOnSubmit,\n    handleModdalClose: handleModdalClose\n  }));\n};\n\nexport default FirebaseCRUD;","map":null,"metadata":{},"sourceType":"module"}